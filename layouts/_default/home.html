{{ define "main" }}
<div class="mt-6 markdown-body introduction">
  {{ .Content }}
</div>

{{ $nowYear := now.Year }}
{{ $allPages := where .Site.RegularPages "Type" "in" (slice "posts" "contribute" "anotherType") }}
{{ $allYears := slice }}
{{ range $allPages }}
  {{ $y := .PublishDate.Year }}
  {{ if not (in $allYears $y) }}
    {{ $allYears = $allYears | append $y }}
  {{ end }}
{{ end }}
{{ $sortedYears := sort $allYears "value" "desc" }}

{{ if gt (len $sortedYears) 1 }}
  <nav class="mt-10 flex flex-wrap gap-2">
    {{ range $year := $sortedYears }}
      <a href="#year-{{ $year }}"
         class="px-3 py-1 border border-gray-300 bg-[#faf8f1] rounded-full text-sm hover:bg-gray-100 text-gray-600">
        {{ $year }}
      </a>
    {{ end }}
  </nav>
{{ end }}


{{ range $year := $sortedYears }}
  <section id="year-{{ $year }}" class="mt-10">
    <h3 class="text-2xl font-semibold mb-4">{{ $year }}年のタイムライン</h3>
    <div class="posts relative border-l-2 border-gray-300 pl-6 space-y-6">
      {{ $yearPages := where $allPages "PublishDate.Year" $year }}
      {{ range $yearPages }}
        <article class="relative ">
          <span class="absolute top-0 -left-6 -translate-x-1/2 w-8 h-8 bg-[#faf8f1] text-white flex items-center justify-center rounded-full text-lg">
            {{ $type := .Params.type | default "post" }}
            {{ if eq $type "contribute" }}
              <i class="fa-brands fa-github text-[#59636e]"></i>
            {{ else if eq $type "release" }}
              <i class="fa-solid fa-rocket text-[#59636e]"></i>
            {{ else }}
              <i class="fa-solid fa-pen-nib text-[#59636e]"></i>
            {{ end }}
          </span>
          <div class="flex items-center gap-2 mb-2">
            <h3>
              {{ $type := .Params.type | default "post" }}
              {{ if eq $type "contribute" }}
               Contribute
              {{ else if eq $type "release" }}
              Release
              {{ else }}
                Blog
              {{ end }}
  
            </h3>
  
            <time datetime="{{ .PublishDate }}" class="inline-block border border-gray-200  text-xs font-medium px-2 py-0.5 rounded-full">
              {{ .PublishDate.Format "01/01" }}
            </time>
          </div>
          <div class="border border-gray-300 rounded-2xl p-4">
            <h2 class="text-lg mt-2">
              {{ if eq $type "contribute" }}
                <a href="{{ .Params.link }}" target="_blank">{{ .Title }}<br /><span class="text-xs text-gray-400">{{ .Params.link }}</span></a>
              {{ else }}
                <a href="{{ .Permalink }}">{{ .Title }}</a>
              {{ end }}
            </h2>
          </div>
      
        </article>
      {{ end }}
    </div>
  </section>
{{ end }}

{{ end }}
